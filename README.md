# SEP400 × Standby — FOD Camera Pack PoC

Reproducible Proof-of-Concept (PoC) pipeline for detecting FOD-like objects in a runway-like scenario using a car-mounted Jetson camera pack.

Pipeline:
1) Jetson records 1080p road videos (GStreamer, H.264, splitmuxsink)
2) PC/WSL runs offline inference (Ultralytics YOLO baseline)
3) ROI + events runner produces deterministic alarm/event outputs (CSV/JSON + metrics)

This repo contains code, ROI definitions, and documentation.
It intentionally does NOT include MP4 datasets or large generated outputs.

## Repository contents
- `jetson/` — recording helpers + notes for Jetson Orin Nano
- `pc_wsl/` — offline inference + ROI/events runner (primary development)
- `docs/` — data layout, environments, reproducibility notes
- `tests/` — tiny synthetic fixtures for CI (no real videos)

## What must NOT be committed
- MP4 videos (`run_*.mp4`)
- Dataset exports (e.g., `~/projects/exports/...`)
- Generated outputs (e.g., `~/projects/fod_outputs/...`)
- Large logs (real `detections.jsonl`)
- Model weights (`*.pt`, `*.engine`)
- Secrets (tokens, credentials, invite links, IPs)

## Quickstart (PC/WSL)

### 0) Set local paths (outside git)
```bash
export FOD_EXPORT_ROOT="$HOME/projects/exports/fod_poc_2025_20251216"
export FOD_OUT_ROOT="$HOME/projects/fod_outputs"
```

Verified on your machine:
- Videos: `$FOD_EXPORT_ROOT/videos/run_*.mp4`
- Outputs root: `$FOD_OUT_ROOT/` (per-run folders)

### 1) Activate your venv
```bash
source ~/projects/.venv_fod/bin/activate
```

### 2) Offline inference (example)
```bash
VID="$FOD_EXPORT_ROOT/videos/run_106012.mp4"

python pc_wsl/offline_infer/offline_infer.py \
  --video "$VID" \
  --outdir "$FOD_OUT_ROOT" \
  --model yolov8n.pt \
  --device 0 \
  --conf 0.25 \
  --imgsz 640 \
  --run-tag y8_conf025_img640
```

### 3) ROI + events runner (example)
```bash
RUN_FOLDER="$FOD_OUT_ROOT/run_106012__y8_conf025_img640"
ROI_JSON="pc_wsl/events/rois/roi_1080p_12mm_roadonly_v1.json"

python pc_wsl/events/events_from_detections.py \
  --run-folder "$RUN_FOLDER" \
  --roi "$ROI_JSON" \
  --conf 0.15 \
  --dist-px 120 \
  --gap-frames 2 \
  --track-mode class \
  --persist-mode consecutive \
  --n-consec 2
```

Deactivate when done:
```bash
deactivate
```

## Jetson recording
See `jetson/recording/README.md`.

## Reproducibility notes
- Environment fingerprints: `docs/ENVIRONMENTS.md`
- Data layout: `docs/DATA_LAYOUT.md`
- Script stamps: `docs/SCRIPT_STAMPS.md`
- Tag milestone: `v0.3_events_runner`

## Events runner output contract and interpretation

**Output contract:** All outputs are written under `<run_folder>/events/<roi_id>/` and never overwrite other `roi_id` folders.

**Note on interpretation:** Proxy detections from COCO can be sparse and inconsistent. This layer cannot increase detection recall; it only structures existing detections into alarms/events with a reproducible rule set.

### Batch run across all runs (optional)
You can run the events runner across all run folders and later aggregate results by collecting each run’s `metrics.json` and `events.csv` under its `events/<roi_id>/` directory. A small summary CSV can be generated by parsing those per-run metrics (next milestone).

